<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Query Execution &#8212; Stitch  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Running" href="Running.html" />
    <link rel="prev" title="Stitch Concepts" href="StitchConcepts.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="query-execution">
<span id="id1"></span><h1>Query Execution<a class="headerlink" href="#query-execution" title="Link to this heading">¶</a></h1>
<p>Stitch is essentially a Directed Acylic Graph (DAG) which is repeatedly simplified until a result is ready.
In other words, a Stitch is a series of synchronous transformations and asynchronous
calls to backends that are chained together. The graph of operations is repeatedly
simplified by performing all the synchronous transformations it can, removing operations
as they are performed. Once no more synchronous operations can be performed,
the available asynchronous calls are performed and the process repeats.
When a part of the graph is simplified then the graph that’s downstream of
that point moves up a level. This means that Stitch isn’t ever analyzing the whole graph,
but just the first level and repeatedly moving things to that level as their parent’s are run.</p>
<p>In the below diagrams, think of <em>transform</em> as a simple synchronous transformation or side effect,
and think of call as meaning an asynchronous operation which requires an RPC.</p>
<p>These diagrams represent a Stitch query and the process of simplification</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG0.png" />
<p>After the first simplification the resulting computation graph would be simplified.
All the <em>transformations</em> would be applied leaving only <em>calls</em> left. This would look like this:</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG1.png" />
<p>Let’s go step-by-step and walk through how this works.</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG2.png" />
<p>Looking at just the first level, the input is already evaluated so we cross it off.</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG3.png" />
<p>We can then shift the entire graph to the left and look at the new first level for synchronous transforms.</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG4.png" />
<p>Running the first one we find we can cross it off. Then we shift all its children to the left.</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG5.png" />
<p>With the shift to the left, we now have another transform on the first level that we can evaluate.</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG6.png" />
<img alt="Graphs showing Stitch simplification" src="_images/DAG7.png" />
<p>We continue the process of evaluating transforms and shifting their children to the left</p>
<img alt="Graphs showing Stitch simplification" src="_images/DAG8.png" />
<img alt="Graphs showing Stitch simplification" src="_images/DAG9.png" />
<img alt="Graphs showing Stitch simplification" src="_images/DAG10.png" />
<p>When there’s no longer any transforms left on the first level
of the graph we can move onto the next step of batching calls.</p>
<p>The newly simplified computation can easily gather all the calls
together and batch them according to their backend, in this case, <em>A</em> and <em>B</em>.</p>
<img alt="Graphs showing the simplified graph before Stitch performs RPCs" src="_images/DAG11.png" />
<p>The Groups are then run and another simplification takes place.</p>
<img alt="Graphs showing the graph after Stitch performs RPCs" src="_images/DAG12.png" />
<p>The final call operation would then be run, simplified, and the Stitch completed.</p>
<img alt="Graphs showing the final steps in simplification" src="_images/DAG13.png" />
<p>The above example shows a simple case of only 2 backends,
however Stitch works with any number of backends.
At each step in the simplification, all calls to each backend are grouped together.
The grouped calls are gathered until the computation can’t continue forward
until an RPC is performed. Then the calls split into batches and RPCs are performed.
With this method of batching, even widely separated calls in the graph of a Stitch
query can end up batched together if they talk to the same backend.</p>
<p>Looking at the above example again, but with a little modification,
what if GroupA and GroupB didn’t complete their RPCs at the same time?</p>
<img alt="Graphs showing what happens if there's timing differences when a Stitch is run" src="_images/DAGalt.png" />
<p>In a case like this then the next simplification that occurs would run the callC that is
a child of GroupB without waiting for GroupA to finish its run.
This can have the surprising result of batching not being as optimal since the callC
after GroupA wouldn’t necessarily be batched with the call after GroupB since they aren’t
both ready at the same time. While this can decrease overall batch size, it generally will
benefit the performance of the Stitch since it will ensure that different parts don’t end
up waiting to execute. However, if the timing is close enough, then they may still end up
batched together.</p>
<p>Next <a class="reference internal" href="Running.html#running"><span class="std std-ref">Running</span></a></p>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Stitch</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="StitchVsFuture.html">Stitch vs Future</a></li>
<li class="toctree-l1"><a class="reference internal" href="WhyUseStitch.html">Why use Stitch?</a></li>
<li class="toctree-l1"><a class="reference internal" href="BasicExamples.html">Basic Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="FailureHandling.html">Failure handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="Groups.html">Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="ServiceAdapters.html">Service Adapters</a></li>
<li class="toctree-l1"><a class="reference internal" href="StitchConcepts.html">Stitch Concepts</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Query Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="Running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="Running.html#never-re-runnable">Never Re-Runnable</a></li>
<li class="toctree-l1"><a class="reference internal" href="EfficientQueries.html">Efficient Queries</a></li>
<li class="toctree-l1"><a class="reference internal" href="StitchCache.html">StitchCache</a></li>
<li class="toctree-l1"><a class="reference internal" href="TwitterLocals.html">Twitter Locals</a></li>
<li class="toctree-l1"><a class="reference internal" href="Recursion.html">Recursion</a></li>
<li class="toctree-l1"><a class="reference internal" href="Advanced.html">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="Arrows.html">Arrows</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="StitchConcepts.html" title="previous chapter">Stitch Concepts</a></li>
      <li>Next: <a href="Running.html" title="next chapter">Running</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/QueryExecution.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>